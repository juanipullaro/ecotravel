{% extends "base.html" %}
{% block body %}
{% include "navbar_v2.html" %}
<link rel="stylesheet" href="./static/css/usertravelcreate.css">
<!--<link rel="stylesheet" href="{{ url_for('static', filename = 'css/profile.css') }}">!-->
<link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
<section id="banner1" class="bg-img" data-bg="banner.jpg" style="background-image: url('static/images/banner11.jpg');">
{% if travels|length == 0 %}
<p class="text-travelnull">No tenés viajes creados</p>
{%else%} 
        {% for travel in travels %}
        <ol class="JwPp0e" style="padding-top: 4.5rem;">
          <li class="gHz6xd Aopndd rZXyy">
            <div class="Tc9hUd DShyMc-MzA5MDg5NDcxMDM4">
                <div class="O7utsb bFjUmb-Tvm9db"></div>
                <div class="OjOEXb Gf8MK" {% if travel.status == 'disponible'%} style="background-color:#54804bc7;box-shadow: 0px 1px 2px #fdf9f9;" {%endif%} ></div>
                <div class="OjOEXb Gf8MK" {% if travel.status == 'completo'  %} style="background-color:rgba(5, 51, 53, 0.65);box-shadow: 0px 1px 2px #fdf9f9;" {%endif%} ></div>
                <div class="OjOEXb Gf8MK" {% if travel.status == 'en_transito' %} style="background-color:rgb(187, 120, 33);box-shadow: 0px 1px 2px #fdf9f9;" {%endif%} ></div>
                <div class="OjOEXb Gf8MK" {% if travel.status == 'finalizado'  %} style="background-color:rgb(157, 66, 66);box-shadow: 0px 1px 2px #fdf9f9;" {%endif%} ></div>
                <div class="OjOEXb Gf8MK" {% if travel.status == 'cancelado' %} style="background-color:rgb(221, 105, 51);box-shadow: 0px 1px 2px #fdf9f9;" {%endif%} ></div>
                <div class="R4EiSb">
                    <h2 class="prWPdf">
                        <a class="onkcGd kj3hr YVvGBb" target="_self"href="{{ url_for('passenger_profile',dni=travel.driver.dni) }}" >
                        <div class="YVvGBb csjh4b">{{ travel.driver.name|capitalize}} {{ travel.driver.surname|capitalize}} 
                        </div></a>
                    </h2>  
                </div>
            </div>
                {% if travel.status == 'cancelado' %}
                    <div class="prueba canc">
                    <div id ="disp" class="statustravel1 fin"   {% if travel.status =='cancelado'%}  style="color:#ec7a1cd6 "   {%endif%}  >
                    {% if travel.status =='cancelado'%}  
                        <span><i  class="fas fa-circle" aria-hidden="true" ></i></span>
                        <span style="color: white;background-color: rgb(219, 105, 12);width: 64%;margin-left: 22%;">Cancelado</span>
                    {%else%} 
                    <div class="statustravel2" style="margin-top: 6%;"><i class="fas fa-circle" aria-hidden="true" ></i></div> 
                    {%endif%}
                    </div> 
                    </div>  
                    <div class="TQYOZc">
                    <img class="rounded-circle article-imgcal" src="{{'/static/profile_pics/' + travel.driver.image_file}}">
                    <div class="lziZub sdDCme" style="text-align: left;">
                            <div id={{travel.id}}>
                            <form class="traveldata">
                                <div  class="oriaccount"><p>Origen:</p> {{travel.origin.location | capitalize}}</div>
                                <div  class="desaccount"><p>Destino:</p> {{travel.dest.location}}</div>
                                <div  class="fecaccount"><p>Fecha:</p> <script>
                                            var meses = new Array ("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre");
                                            var diasSemana = new Array("Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo");
                                            var f=new Date('{{ travel.travel_date.strftime("%Y-%m-%d") }}'  );
                                            document.write(diasSemana[f.getDay()] + ", " + (f.getDate()+1) + " de " + meses[f.getMonth()] + " de " + f.getFullYear());
                                        </script></div>
                                <div  class="horaccount"><p>Hora:</p>{{ travel.travel_hour}}</div>
                            </form>
                            </div>
                        </div>
                    </div>
                    {%endif%}
                    {%if travel.status =='finalizado' %} 
                    <div class="prueba fin">
                        <div id ="disp" class="statustravel1 fin"   {% if travel.status =='finalizado'%}  style="color:#c21e1ed6 "   {%endif%}  >
                        {% if travel.status =='finalizado'%}  
                            <span><i  class="fas fa-circle" aria-hidden="true" ></i></span>
                            <span style="color: white;background-color: rgb(128, 15, 0);width: 64%;margin-left: 22%;">Finalizado</span>
                        {%else%} 
                        <div class="statustravel2" style="margin-top: 6%;"><i class="fas fa-circle" aria-hidden="true" ></i></div> 
                        {%endif%}
                        </div> 
                    </div>  
                    <div class="TQYOZc">
                    <img class="rounded-circle article-imgcal" src="{{'/static/profile_pics/' + travel.driver.image_file}}">
                    <div class="lziZub sdDCme" style="text-align: left;">
                            <div id={{travel.id}}>
                            <form class="traveldata">
                                <div  class="oriaccount"><p>Origen:</p> {{travel.origin.location | capitalize}}</div>
                                <div  class="desaccount"><p>Destino:</p> {{travel.dest.location}}</div>
                                <div  class="fecaccount"><p>Fecha:</p> <script>
                                            var meses = new Array ("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre");
                                            var diasSemana = new Array("Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo");
                                            var f=new Date('{{ travel.travel_date.strftime("%Y-%m-%d") }}'  );
                                            document.write(diasSemana[f.getDay()] + ", " + (f.getDate()+1) + " de " + meses[f.getMonth()] + " de " + f.getFullYear());
                                        </script></div>
                                <div  class="horaccount"><p>Hora:</p>{{ travel.travel_hour}}</div>
                                <div  class="ecotravelsccount"><p>Ecotravelers subidos:</p></div>
                            <div class="seatsdis">
                            {% for travel_request in travel.getfin_request() %}
                                <i class="fa fa-user v1" aria-hidden="true"> </i> 
                            {%endfor%}   
                                {% for i in range (travel.seatsdec - travel.getfin_request()|length) %}
                                <i class="fa fa-user v2" aria-hidden="true"></i>
                                {%endfor%} 
                            </div>
                            </form>
                            </div>
                        </div>
                    </div>
                    {% if travel.getfin_request()|length > 0 %}
                        <a class="btn-view" data-toggle="modal" data-target="#sendModal{{travel.id}}"><i class="fas fa-eye"></i></a>
                        <div class="modal fade" id="sendModal{{travel.id}}" tabindex="-1" role="dialog" aria-labelledby="sendModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                        <div class="modal-content">
                        <div class="modal-header">
                        <h5 class="modal-title" id="sendModalLabel">Ecotravelers en tu viaje</h5>
                        </div>
                        <div class="modal-footer">
                        {% for request in travel.getfin_request() %}
                           <div class="passenger"><a class="passenger" href="{{ url_for('passenger_profile',dni=request.passenger.dni) }}">{{request.passenger.name|capitalize}} {{request.passenger.surname|capitalize}}                                                              
                            <div class="passagers" >
                                <a class="btn-scoretravel" data-toggle="modal" data-target="#sendModal" style="color: #fff;font-size:14px;margin-left: 27%;" >Calificar pasajero</a>
                            </div></a>   </div>   
                        {% endfor %}        
                        </div>
                        </div>
                        </div>
                        </div>                                                                                                                                                                                                   
                    {%endif%} 
                    {%if scores|length ==0 %}
                    
                    <div class="modal fade" id="sendModal" tabindex="-1" role="dialog" aria-labelledby="sendModalLabel" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                        <div class="modal-contentscore">
                          <div class="modal-header">
                            <h5 class="modal-titlescore" id="sendModalLabel">¿Cómo fue tu viaje?</h5>
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <div class="modal-footerscore">
                            <form action="{{ url_for('new_post', id_passenger=current_user.dni,travel_id=travel.id ) }}" method="POST" class="score">
                                <div class="scores_v1">     
                                  <input id="point-0" name="point" type="radio" value="1"><i class="fas fa-thumbs-up"></i>
                                  <input id="point-1" name="point" type="radio" value="0"><i class="fas fa-thumbs-down"></i>
                                </div>             
                                <div class="form-group">
                                      {{ form.comment.label(class="form-control-label") }}
                                      {% if form.comment.errors %}
                                          {{ form.comment(class="form-control form-control-lg is-invalid") }}
                                          <div class="invalid-feedback">
                                              {% for error in form.comment.errors %}
                                                  <span>{{ error }}</span>
                                              {% endfor %}
                                          </div>
                                      {% else %}
                                          {{form.comment(class="form-control form-control-lg") }}
                                      {% endif %}
                                  </div>
                                 {{ form.submit2(class="btn-scoretravel") }}
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                    {%else%}
                     {% if travel_req.travel_id ==travel_req.score.travel_id %}
                      <div class="statustravelscore"><p> ¡Ecotraveler calificado! </p></div>
                      {%else %}
                      <a class="btn-scoretravel" data-toggle="modal" data-target="#sendModal" style="color: white;" >Calificar viaje</a>     
                      <div class="modal fade" id="sendModal" tabindex="-1" role="dialog" aria-labelledby="sendModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                          <div class="modal-contentscore">
                            <div class="modal-header">
                              <h5 class="modal-titlescore" id="sendModalLabel">¿Cómo fue tu viaje?</h5>
                                <span aria-hidden="true">&times;</span>
                              </button>
                            </div>
                            <div class="modal-footerscore">
                              <form action="{{ url_for('new_post',travel_id=travel_req.travel.id ) }}" method="POST" class="score">
                                  <div class="scores_v1">     
                                    <input id="point-0" name="point" type="radio" value="1"><i class="fas fa-thumbs-up"></i>
                                    <input id="point-1" name="point" type="radio" value="0"><i class="fas fa-thumbs-down"></i>
                                  </div>             
                                  <div class="form-group">
                                        {{ form.comment.label(class="form-control-label") }}
                                        {% if form.comment.errors %}
                                            {{ form.comment(class="form-control form-control-lg is-invalid") }}
                                            <div class="invalid-feedback">
                                                {% for error in form.comment.errors %}
                                                    <span>{{ error }}</span>
                                                {% endfor %}
                                            </div>
                                        {% else %}
                                            {{form.comment(class="form-control form-control-lg") }}
                                        {% endif %}
                                    </div>
                                    {{ form.submit2(class="btn-scoretravel") }}
                              </form>
                            </div>
                          </div>
                        </div>
                      </div>
                      {%endif%}
                     {%endif%}   
                    {%endif %}
                    {%if travel.status =='en_transito' %} 
                    <div class="prueba fin">
                        <div id ="disp" class="statustravel1 fin"   {% if travel.status =='en_transito'%}  style="color:#e6c203d6"   {%endif%}  >
                        {% if travel.status =='en_transito'%}  
                            <span><i  class="fas fa-circle" aria-hidden="true" ></i></span>
                            <span style="color: white;background-color: #e6c203d6;width: 64%;margin-left: 22%;">En curso</span>
                        {%else%} 
                        <div class="statustravel2" style="margin-top: 6%;"><i class="fas fa-circle" aria-hidden="true" ></i></div> 
                        {%endif%}
                        </div> 
                    </div>  
                    <div class="TQYOZc">
                    <img class="rounded-circle article-imgcal" src="{{'/static/profile_pics/' + travel.driver.image_file}}">
                    <div class="lziZub sdDCme" style="text-align: left;">
                            <div id={{travel.id}}>
                            <form class="traveldata">
                                <div  class="oriaccount"><p>Origen:</p> {{travel.origin.location | capitalize}}</div>
                                <div  class="desaccount"><p>Destino:</p> {{travel.dest.location}}</div>
                                <div  class="fecaccount"><p>Fecha:</p> <script>
                                            var meses = new Array ("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre");
                                            var diasSemana = new Array("Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo");
                                            var f=new Date('{{ travel.travel_date.strftime("%Y-%m-%d") }}'  );
                                            document.write(diasSemana[f.getDay()] + ", " + (f.getDate()+1) + " de " + meses[f.getMonth()] + " de " + f.getFullYear());
                                        </script></div>
                                <div  class="horaccount"><p>Hora:</p>{{ travel.travel_hour}}</div>
                                <div  class="ecotravelsccount"><p>Ecotravelers subidos:</p></div>
                            <div class="seatsdis">
                            {% for travel_request in travel.getaccept_request() %}
                                <i class="fa fa-user v1" aria-hidden="true"> </i> 
                            {%endfor%}   
                                {% for i in range (travel.seatsdec - travel.getaccept_request()|length) %}
                                <i class="fa fa-user v2" aria-hidden="true"></i>
                                {%endfor%} 
                            </div>
                            </form>
                            <a class="btn-fintravel" href="{{ url_for('fin_travel', id_travel=travel.id ) }}" >Finalizar viaje</a>    
                            </div>
                        </div>
                    </div>
                    {% if travel.getaccept_request()|length > 0 %}
                        <a class="btn-view" data-toggle="modal" data-target="#sendModal{{travel.id}}"><i class="fas fa-eye"></i></a>
                        <div class="modal fade" id="sendModal{{travel.id}}" tabindex="-1" role="dialog" aria-labelledby="sendModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                        <div class="modal-content">
                        <div class="modal-header">
                        <h5 class="modal-title" id="sendModalLabel">Ecotravelers en tu viaje</h5>
                        </div>
                        <div class="modal-footer">
                        {% for request in travel.getaccept_request() %}
                           <div class="passenger"><a class="passenger" href="{{ url_for('passenger_profile',dni=request.passenger.dni) }}">{{request.passenger.name|capitalize}} {{request.passenger.surname|capitalize}}                                                              
                            <div class="passagers" >
                                <a class="btn-uppassengertravel" data-toggle="modal" data-target="#sendModal" style="color: #102028;font-size:14px;margin-left: 0%;" >Ecotraveler en viaje</a>
                            </div></a>   </div>   
                        {% endfor %}        
                        </div>
                        </div>
                        </div>
                        </div>                                                                                                                                                                                                   
                    {%endif%} 
                     
                    {%endif %}


                    {%if travel.status=='disponible' or travel.status=='completo'%}
                        <h2 class="prWPdf">
                            <div class="octbar">
                            <a href="{{ url_for('delete_post', id_viaje=travel.id) }}">
                                        <svg class="octicon octicon-trash" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true" >
                                            <path fill-rule="evenodd" d="M6.5 1.75a.25.25 0 01.25-.25h2.5a.25.25 0 01.25.25V3h-3V1.75zm4.5 0V3h2.25a.75.75 0 010 1.5H2.75a.75.75 0 010-1.5H5V1.75C5 .784 5.784 0 6.75 0h2.5C10.216 0 11 .784 11 1.75zM4.496 6.675a.75.75 0 10-1.492.15l.66 6.6A1.75 1.75 0 005.405 15h5.19c.9 0 1.652-.681 1.741-1.576l.66-6.6a.75.75 0 00-1.492-.149l-.66 6.6a.25.25 0 01-.249.225h-5.19a.25.25 0 01-.249-.225l-.66-6.6z"></path>
                                        </svg>
                                        </a>
                            <a href="{{ url_for('update_travels', travel_id=travel.id) }}">
                            <svg class="octicon octicon-pencil" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
                                <path fill-rule="evenodd" d="M11.013 1.427a1.75 1.75 0 012.474 0l1.086 1.086a1.75 1.75 0 010 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 01-.927-.928l.929-3.25a1.75 1.75 0 01.445-.758l8.61-8.61zm1.414 1.06a.25.25 0 00-.354 0L10.811 3.75l1.439 1.44 1.263-1.263a.25.25 0 000-.354l-1.086-1.086zM11.189 6.25L9.75 4.81l-6.286 6.287a.25.25 0 00-.064.108l-.558 1.953 1.953-.558a.249.249 0 00.108-.064l6.286-6.286z"></path>
                            </svg>
                            </a>
                            </div>  
                        </h2>  
                    <div class="prueba">
                        <div id ="disp" class="statustravel1"   {% if travel.status =='disponible'%}  style="color:#1ebb1ed6 "   {%endif%}  >
                        {% if travel.status =='disponible'%}  
                            <span><i  class="fas fa-circle" aria-hidden="true" ></i></span>
                            <span style="color: white;background-color: green;width: 64%;margin-left: 22%;">Disponible</span>
                        {%else%} 
                        <div class="statustravel2" style="margin-top: 6%;"><i class="fas fa-circle" aria-hidden="true" ></i></div> 
                        {%endif%}
                        </div> 
                        <div id="com" class="statustravel1"  {% if travel.status =='completo'%}    style="color:#204051;"   {%endif%} >
                        {% if travel.status =='completo'%}
                            <span><i  class="fas fa-circle " aria-hidden="true" ></i></span>   
                            <span style="color: white;background-color: #204051;width: 57%;margin-left: 20%;">Completo</span>
                        {%else%} 
                        <div class="statustravel2" style="margin-top: 6%;"><i class="fas fa-circle" aria-hidden="true" ></i></div> 
                        {%endif%}
                        </div> 
                        </div>
                        <div class="TQYOZc">
                        <img class="rounded-circle article-imgcal" src="{{'/static/profile_pics/' + travel.driver.image_file}}">
                        <div class="lziZub sdDCme" style="text-align: left;">
                        <div id={{travel.id}}>
                            <form class="traveldata">
                                <div  class="oriaccount"><p>Origen:</p> {{travel.origin.location | capitalize}}</div>
                                <div  class="desaccount"><p>Destino:</p> {{travel.dest.location}}</div>
                                <div  class="fecaccount"><p>Fecha:</p> <script>
                                                var meses = new Array ("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre");
                                                var diasSemana = new Array("Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo");
                                                var f=new Date('{{ travel.travel_date.strftime("%Y-%m-%d") }}'  );
                                                document.write(diasSemana[f.getDay()] + ", " + (f.getDate()+1) + " de " + meses[f.getMonth()] + " de " + f.getFullYear());
                                            </script></div>
                                <div  class="horaccount"><p>Hora:</p>{{ travel.travel_hour}}</div>
                                <div  class="ecotravelsccount"><p>Ecotravelers subidos:</p></div>
                                <div class="seatsdis">
                                {% for travel_request in travel.getaccept_request() %}
                                    <i class="fa fa-user v1" aria-hidden="true"></i> 
                                {%endfor%}   
                                {% for i in range (travel.seatsdec - travel.getaccept_request()|length) %}
                                    <i class="fa fa-user v2" aria-hidden="true"></i>
                                {%endfor%} 
                                </div>
                            </form>
                        </div>
                        </div>
                        </div>
                        </div>
                        {% if travel.getpending_request()|length > 0 %}
                            <div class="btn-cantrequests">{{travel.getpending_request()|length}}</div>
                            <a class="btn-requestcant" data-toggle="modal" data-target="#sendModal"><i class="fas fa-user-plus"></i></a>
                            <div class="modal fade" id="sendModal" tabindex="-1" role="dialog" aria-labelledby="sendModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                            <div class="modal-content">
                            <div class="modal-header">
                            <h5 class="modal-title" id="sendModalLabel">Solicitudes a tu viaje</h5>
                            </div>
                            <div class="modal-footer">
                            {% for request in travel.getpending_request() %}
                               <div  class="passenger"><a href="{{ url_for('passenger_profile',dni=request.passenger.dni) }}">{{request.passenger.name|capitalize}} {{request.passenger.surname|capitalize}}                                                                
                                <div class="passagers" >
                                    <a class= "acep" href="{{ url_for('add_request', id_passenger=request.passenger.dni,id_travel=request.travel.id ) }}">Aceptar</a>
                                    <a class= "rech" href="{{ url_for('reject_request', id_passenger=request.passenger.dni,id_travel=request.travel.id ) }}">Rechazar</a>
                                </div></a> </div>      
                            {% endfor %}        
                            </div>
                            </div>
                            </div>
                            </div>                                                                                                                                                                                                   
                        {%endif%} 
                        {% if travel.getaccept_request()|length > 0 %}
                        <a class="btn-view" data-toggle="modal" data-target="#sendModal{{travel.id}}"><i class="fas fa-eye"></i></a>
                        <div class="modal fade" id="sendModal{{travel.id}}" tabindex="-1" role="dialog" aria-labelledby="sendModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                        <div class="modal-content">
                        <div class="modal-header">
                        <h5 class="modal-title" id="sendModalLabel">Ecotravelers en tu viaje</h5>
                        </div>
                        <div class="modal-footer">
                        {% for request in travel.getaccept_request() %}
                           <div class="passenger"> <a href="{{ url_for('passenger_profile',dni=request.passenger.dni) }}">{{request.passenger.name|capitalize}} {{request.passenger.surname|capitalize}}                                                                
                            <div class="passagers">
                                <a class= "rech" href="{{ url_for('down_request_driver', id_passenger=request.passenger.dni,id_travel=request.travel.id ) }}">Bajar del viaje</a>
                            </div></a></div>      
                        {% endfor %}        
                        </div>
                        </div>
                        </div>
                        </div>                                                                                                                                                                                                   
                    {%endif%} 
                    {%endif%}        
                    </li>
                </ol>
                   
    {% endfor %}
{%endif%}
</section>

<script >
    const jointravel = (id) => {
        fetch('/unirme/' + id)
            .then(() => {
                console.log("se ha unido satisfactoriamente")
            })
    };
</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
    integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
    crossorigin="anonymous">
</script>

<script type="text/javascript" charset="utf-8">
    var socket = io();
    socket.on('message', data => {
        location.reload()
    });
    
    const updateTravels = () =>{
      fetch("/update_travels_status")
      .then(response =>{
        setTimeout(updateTravels,10000)
      })
    }
    setTimeout(updateTravels,10000)
</script>

{% endblock body %}
